CONTIKI_PROJECT_CLIENT = udp-client-no-data
CONTIKI_PROJECT_SERVER = udp-server-no-data

CONTIKI_PROJECT = $(CONTIKI_PROJECT_CLIENT) $(CONTIKI_PROJECT_SERVER)

all: $(CONTIKI_PROJECT)

OBJDUMP = msp430-objdump

CFLAGS += -DUIP_CONF_UDP=0 -DUIP_CONF_TCP=0 -DNETSTACK_CONF_WITH_IPV6=0

bytes_client: 
	@$(OBJDUMP) -h $(CONTIKI_PROJECT_CLIENT).sky | perl -ne '$$b{$$1}=hex $$2 if /^\s*\d+\s*\.(text|data|bss)\s+(\S+)/; END { printf("%16d bytes in ROM\n%16d bytes in RAM\n",$$b{text}+$$b{data},$$b{data}+$$b{bss}); }'

bytes_client2: 
	@$(OBJDUMP) -h $(CONTIKI_PROJECT_CLIENT2).sky | perl -ne '$$b{$$1}=hex $$2 if /^\s*\d+\s*\.(text|data|bss)\s+(\S+)/; END { printf("%16d bytes in ROM\n%16d bytes in RAM\n",$$b{text}+$$b{data},$$b{data}+$$b{bss}); }'

bytes_server:
	@$(OBJDUMP) -h $(CONTIKI_PROJECT_SERVER).sky | perl -ne '$$b{$$1}=hex $$2 if /^\s*\d+\s*\.(text|data|bss)\s+(\S+)/; END { printf("%16d bytes in ROM\n%16d bytes in RAM\n",$$b{text}+$$b{data},$$b{data}+$$b{bss}); }'

# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# +++ FLOCKLAB +++
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++	
	
flocklab_debug_pins_extra: CFLAGS += -DINITIATOR_NODE_ID=1 \
				-DUSE_TINYOS_NODEIDS=1 -DTINYOS_SERIAL_FRAMES=0 \
				-DFLOCKLAB=1 -DCOOJA=0 -DLOCAL_NODES=0 -DBURN_NODE_ID=0 \
				-DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=1 -DLANEFLOOD_DEBUG_STATUS=0 \
				-DWHISPER_PREAMBLE_LENGTH=4 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=9 \
				-DWHISPER_DC_WITH_APP=0 \
				-DWHISPER_RADIO_ALWAYS_ON=1 -DWHISPER_AGNOSTIC_SAMPLING=0 -DWHISPER_DIRECTION_AWARE_SAMPLING=0 \
				-DWHISPER_DIRECTION_MODE=1 -DWHISPER_MANY_SENDERS=0 \
				-DCC2420_ENABLE_TESTMODE=0 -DWHISPER_LONG_WAKEUP_PACKET=1 -DWHISPER_NTX=0 \
				-DCC2420_DEFAULT_TX_POWER=31 -DCC2420_LOW_TX_POWER=0 \
				-DMEASURE_IDLE_LISTENING=0 \
				-DWITH_GLOSSY=0
flocklab_debug_pins_extra: $(CONTIKI_PROJECT_CLIENT) bytes_client $(CONTIKI_PROJECT_SERVER) bytes_server
	cp $(CONTIKI_PROJECT_CLIENT).sky $(CONTIKI_PROJECT_CLIENT).flocklab_debug_pins_extra.sky
	cp $(CONTIKI_PROJECT_SERVER).sky $(CONTIKI_PROJECT_SERVER).flocklab_debug_pins_extra.sky

# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# +++ INDRIYA +++
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
indriya_debug_all: CFLAGS += -DINITIATOR_NODE_ID=31 -DUSE_TINYOS_NODEIDS=1  -DTINYOS_SERIAL_FRAMES=1 \
							 -DFLOCKLAB=0 -DINDRIYA=1 -DCOOJA=0 -DLOCAL_NODES=0 -DBURN_NODE_ID=0 -DGLOSSY_DEBUG=1 -DGLOSSY_DEBUG_PINS=1 -DGLOSSY_DEBUG_STATUS=1
indriya_debug_all: $(CONTIKI_PROJECT) bytes
	cp $(CONTIKI_PROJECT).sky $(CONTIKI_PROJECT).indriya_debug_all.exe
	
	
indriya_debug_extra: CFLAGS += -DINITIATOR_NODE_ID=31 \
				-DUSE_TINYOS_NODEIDS=1 -DTINYOS_SERIAL_FRAMES=1 \
				-DFLOCKLAB=0 -DCOOJA=0 -DINDRIYA=1 -DLOCAL_NODES=0 -DBURN_NODE_ID=0 \
				-DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=0 -DLANEFLOOD_DEBUG_STATUS=0 \
				-DWHISPER_PREAMBLE_LENGTH=2 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=7 \
				-DWHISPER_DC_WITH_APP=0 \
				-DWHISPER_RADIO_ALWAYS_ON=1 -DWHISPER_AGNOSTIC_SAMPLING=0
indriya_debug_extra: $(CONTIKI_PROJECT_CLIENT) bytes_client $(CONTIKI_PROJECT_SERVER) bytes_server
	cp $(CONTIKI_PROJECT_CLIENT).sky $(CONTIKI_PROJECT_CLIENT).indriya_debug_extra.exe
	cp $(CONTIKI_PROJECT_SERVER).sky $(CONTIKI_PROJECT_SERVER).indriya_debug_extra.exe
	
indriya_hello_world: CFLAGS += -DINDRIYA=1 -DUSE_TINYOS_NODEIDS=1  -DTINYOS_SERIAL_FRAMES=1 
indriya_hello_world: $(CONTIKI_PROJECT) bytes
	cp $(CONTIKI_PROJECT).sky $(CONTIKI_PROJECT).indriyahelloworld.exe

# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# +++ TWIST +++
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

twist_debug_extra: CFLAGS += -DINITIATOR_NODE_ID=192 \
				-DUSE_TINYOS_NODEIDS=1 -DTINYOS_SERIAL_FRAMES=1 \
				-DFLOCKLAB=0 -DINDRIYA=0 -DTWIST=1 -DCOOJA=0 -DLOCAL_NODES=0 -DBURN_NODE_ID=0 \
				-DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=0 -DLANEFLOOD_DEBUG_STATUS=0 \
				-DWHISPER_PREAMBLE_LENGTH=2 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=7 \
				-DWHISPER_DC_WITH_APP=0
twist_debug_extra: $(CONTIKI_PROJECT_CLIENT) bytes_client $(CONTIKI_PROJECT_SERVER) bytes_server
	cp $(CONTIKI_PROJECT_CLIENT).sky $(CONTIKI_PROJECT_CLIENT).twist_debug_extra.exe
	cp $(CONTIKI_PROJECT_SERVER).sky $(CONTIKI_PROJECT_SERVER).twist_debug_extra.exe

# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# +++ COOJA +++
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	
cooja_debug_pins_extra: CFLAGS += -DINITIATOR_NODE_ID=1 \
				  -DUSE_TINYOS_NODEIDS=0 -DFLOCKLAB=0 -DCOOJA=1 -DLOCAL_NODES=0 -DBURN_NODE_ID=0 \
				  -DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=1 -DLANEFLOOD_DEBUG_STATUS=0 \
				  -DWHISPER_PREAMBLE_LENGTH=4 -DWHISPER_CLOCKDRIFT_COMP=0 -DWHISPER_PACKET_LENGTH=9 \
				  -DWHISPER_DC_WITH_APP=0 \
				  -DWHISPER_RADIO_ALWAYS_ON=1 -DWHISPER_AGNOSTIC_SAMPLING=0 -DWHISPER_DIRECTION_AWARE_SAMPLING=0 \
				  -DWHISPER_DIRECTION_MODE=1 -DWHISPER_MANY_SENDERS=0 \
				  -DCC2420_ENABLE_TESTMODE=0 -DWHISPER_LONG_WAKEUP_PACKET=1 -DWHISPER_NTX=0 \
				  -DCC2420_DEFAULT_TX_POWER=31 -DCC2420_LOW_TX_POWER=1 \
				  -DMEASURE_IDLE_LISTENING=0 \
				  -DWITH_GLOSSY=0
cooja_debug_pins_extra: $(CONTIKI_PROJECT_CLIENT) bytes_client $(CONTIKI_PROJECT_SERVER) bytes_server
	cp $(CONTIKI_PROJECT_CLIENT).sky $(CONTIKI_PROJECT_CLIENT).cooja_debug_pins_extra.sky
	cp $(CONTIKI_PROJECT_SERVER).sky $(CONTIKI_PROJECT_SERVER).cooja_debug_pins_extra.sky

# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# +++ LOCAL NODES +++
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
local_nodes_debug_all: CFLAGS += -DUSE_TINYOS_NODEIDS=0 -DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=0 -DGLOSSY_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=0 -DGLOSSY_DEBUG_STATUS=1
local_nodes_debug_all: $(CONTIKI_PROJECT) bytes
	cp $(CONTIKI_PROJECT).sky $(CONTIKI_PROJECT).nodes_debug_all.sky
	
local_nodes_upload_initiator: CFLAGS += -DINITIATOR_NODE_ID=1 \
				-DUSE_TINYOS_NODEIDS=0 -DTINYOS_SERIAL_FRAMES=0 \
				-DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=0 \
				-DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=1 -DLANEFLOOD_DEBUG_STATUS=0 \
				-DWHISPER_PREAMBLE_LENGTH=2 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=7 \
				-DWHISPER_DC_WITH_APP=0 \
				-DWHISPER_RADIO_ALWAYS_ON=0 -DWHISPER_AGNOSTIC_SAMPLING=0 -DWHISPER_DIRECTION_AWARE_SAMPLING=0 \
				-DWHISPER_DIRECTION_MODE=1 -DWHISPER_MANY_SENDERS=0 \
				-DCC2420_ENABLE_TESTMODE=1 -DWHISPER_LONG_WAKEUP_PACKET=0 -DWHISPER_NTX=3 \
				-DCC2420_DEFAULT_TX_POWER=3 -DCC2420_LOW_TX_POWER=1 \
				-DMEASURE_IDLE_LISTENING=0 \
				-DWITH_GLOSSY=0
local_nodes_upload_initiator: $(CONTIKI_PROJECT_CLIENT).upload
	
local_nodes_upload_receiver: CFLAGS += -DINITIATOR_NODE_ID=1 \
				-DUSE_TINYOS_NODEIDS=0 -DTINYOS_SERIAL_FRAMES=0 \
				-DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=0 \
				-DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=1 -DLANEFLOOD_DEBUG_STATUS=0 \
				-DWHISPER_PREAMBLE_LENGTH=2 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=7 \
				-DWHISPER_DC_WITH_APP=0 \
				-DWHISPER_RADIO_ALWAYS_ON=1 -DWHISPER_AGNOSTIC_SAMPLING=0 -DWHISPER_DIRECTION_AWARE_SAMPLING=0 \
				-DWHISPER_DIRECTION_MODE=1 -DWHISPER_MANY_SENDERS=0 \
				-DCC2420_ENABLE_TESTMODE=1 -DWHISPER_LONG_WAKEUP_PACKET=0 -DWHISPER_NTX=3 \
				-DCC2420_DEFAULT_TX_POWER=11 -DCC2420_LOW_TX_POWER=1 \
				-DMEASURE_IDLE_LISTENING=0 \
				-DWITH_GLOSSY=0
local_nodes_upload_receiver: $(CONTIKI_PROJECT_SERVER).upload

local_nodes_upload_burnid_1: CFLAGS += -DINITIATOR_NODE_ID=1 \
				       -DUSE_TINYOS_NODEIDS=0 -DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=1 -DLOCAL_NODE_ID=1 \
				       -DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=0 -DLANEFLOOD_DEBUG_STATUS=0 \
				       -DWHISPER_PREAMBLE_LENGTH=4 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=9 \
				       -DWHISPER_DC_WITH_APP=0 \
				       -DWHISPER_RADIO_ALWAYS_ON=1 -DWHISPER_AGNOSTIC_SAMPLING=0 -DWHISPER_DIRECTION_AWARE_SAMPLING=0 \
				       -DWHISPER_DIRECTION_MODE=1 -DCC2420_ENABLE_TESTMODE=0 -DWHISPER_LONG_WAKEUP_PACKET=0 -DWHISPER_NTX=0\
				       -DCC2420_DEFAULT_TX_POWER=31 -DCC2420_LOW_TX_POWER=0 \
				       -DMEASURE_IDLE_LISTENING=0
local_nodes_upload_burnid_1: $(CONTIKI_PROJECT_CLIENT).upload

local_nodes_upload_burnid_2: CFLAGS += -DUSE_TINYOS_NODEIDS=0 -DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=1 -DLOCAL_NODE_ID=2 \
				       -DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=0 -DLANEFLOOD_DEBUG_STATUS=0 \
				       -DWHISPER_PREAMBLE_LENGTH=4 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=9 \
				       -DWHISPER_DC_WITH_APP=0 \
				       -DWHISPER_RADIO_ALWAYS_ON=1 -DWHISPER_AGNOSTIC_SAMPLING=0 -DWHISPER_DIRECTION_AWARE_SAMPLING=0 \
				       -DWHISPER_DIRECTION_MODE=1 -DCC2420_ENABLE_TESTMODE=0 -DWHISPER_LONG_WAKEUP_PACKET=0 -DWHISPER_NTX=0\
				       -DCC2420_DEFAULT_TX_POWER=31 -DCC2420_LOW_TX_POWER=0 \
				       -DMEASURE_IDLE_LISTENING=0
local_nodes_upload_burnid_2: $(CONTIKI_PROJECT_SERVER).upload

local_nodes_upload_burnid_3: CFLAGS += -DUSE_TINYOS_NODEIDS=0 -DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=1 -DLOCAL_NODE_ID=3 \
				       -DLANEFLOOD_DEBUG=1 -DLANEFLOOD_DEBUG_PINS=1 -DLANEFLOOD_DEBUG_STATUS=0 \
				       -DWHISPER_PREAMBLE_LENGTH=2 -DWHISPER_CLOCKDRIFT_COMP=1 -DWHISPER_PACKET_LENGTH=7 \
				       -DWHISPER_DC_WITH_APP=0 \
				       -DWHISPER_RADIO_ALWAYS_ON=0 -DWHISPER_AGNOSTIC_SAMPLING=1
local_nodes_upload_burnid_3: $(CONTIKI_PROJECT_SERVER).upload
	
local_nodes_upload_burnid_4: CFLAGS += -DUSE_TINYOS_NODEIDS=0 -DFLOCKLAB=0 -DCOOJA=0 -DLOCAL_NODES=1 -DBURN_NODE_ID=1 -DLOCAL_NODE_ID=4 -DLANEFLOOD_DEBUG=0 -DLANEFLOOD_DEBUG_PINS=1 -DLANEFLOOD_DEBUG_STATUS=0
local_nodes_upload_burnid_4: $(CONTIKI_PROJECT_SERVER).upload

asm_marco_server:
	@$(OBJDUMP) -d $(CONTIKI_PROJECT_SERVER).sky > $(CONTIKI_PROJECT_SERVER).dis


CONTIKI = ../..
CONTIKI_WITH_IPV6 = 0
include $(CONTIKI)/Makefile.include
